<script type="text/javascript" charset="utf-8">     
     $(document).bind('ready', function() {
    //$(document).ready(function() {
        $(".claim-result-link").click(function(e) {
            $('#claim-result-form').append($('<input type="hidden" name="user" value="' + <%= current_user.id if current_user %> + '"/>'));
            $('#claim-result-form').append($('<input type="hidden" name="type" value="' + $(this).attr('data-type') + '"/>'));
            $('#claim-result-form').append($('<input type="hidden" name="result" value="' + $(this).attr('data-result') + '"/>'));
            $('#claim-result-form').submit();
            e.preventDefault();
        })
    }); // end ready()
</script>

<%= form_tag(participations_path, :remote => true, :id => 'claim-result-form') do |f| %>
<% end %>

<table class="table table-striped table-condensed" width="100%">
    <thead>
    <tr>
        <th><%= sortable('last_name', 'name', true) %></th>
        <th><%= sortable('overall_place', 'rank', true) %></th>
        <th><%= sortable('div', 'div', true) %></th>
        <th><%= sortable('points', 'points', true) %></th>
        <th><%= sortable('grade', 'grade', true) %></th>
        <th colspan="2">&nbsp;</th></tr>
    </thead>
    <% @results.each do |result| %>
    <tr class="<%= cycle('normal', 'stripe') %>">
        <%= render(:partial => 'results/result_row', :locals => { :result => result }) %>
        <td>
            <% if current_user %>
                <div class="btn-group">
                    <a class="btn" href="#">...</a>
                    <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                        <% Lookup.list_for('participation_type').each do |ty| %>
                            <%= link_to("this is #{ty.description}", '#', :class => 'claim-result-link', 'data-type' => ty.id, 'data-result' => result.id) %>
                        <% end %>
                    </ul>
                </div>
                <!--
                <div id="claim_link_<%= result.id %>"><%= claim_result_link(result) %></div>
                -->
            <% else %>
                &nbsp;
            <% end %>
        </td>
        <td>
            <% if current_user %>
                <div id="claims_<%= result.id %>"><%= participations(result, current_user) %></div>
            <% else %>
                &nbsp;
            <% end %>
        </td>
    </tr>
    
    <% end %>
</table>
<%= paginate @results, :remote => true %>