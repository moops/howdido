<script type="text/javascript" charset="utf-8">
    $(document).ready(function() {
        $(".claim-result-link").click(function(event) {
            $('#claim-result-form').append($('<input type="hidden" name="result" value="' + $(this).attr('data-type') + '"/>'));
            $('#claim-result-form').append($('<input type="hidden" name="type" value="' + $(this).attr('data-result') + '"/>'));
            $('#claim-result-form').submit();
            //alert('claim result link clicked. submit form with result: ' + $(this).attr('data-result') + ' and type: ' + $(this).attr('data-type'));
            event.preventDefault();
        })
    });
</script>

<%= form_tag(participations_path, :id => 'claim-result-form') do |f| %>
    <%= hidden_field_tag(:user, :value => current_user) %>
<% end %>

<table class="table table-striped table-condensed" width="100%">
    <thead>
    <tr>
        <th><%= sortable('last_name', 'name', true) %></th>
        <th><%= sortable('overall_place', 'rank', true) %></th>
        <th><%= sortable('div', 'div', true) %></th>
        <th><%= sortable('points', 'points', true) %></th>
        <th><%= sortable('grade', 'grade', true) %></th>
        <th colspan="2">&nbsp;</th></tr>
    </thead>
    <% @results.each do |result| %>
    <tr class="<%= cycle('normal', 'stripe') %>">
        <%= render(:partial => 'results/result_row', :locals => { :result => result }) %>
        <td>
            <div class="btn-group">
                <a class="btn" href="#">...</a>
                <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
                    <span class="caret"></span>
                </a>
                <ul class="dropdown-menu">
                    <% Lookup.list_for('participation_type').each do |ty| %>
                        <%= link_to("this is #{ty.description}", '#', :class => 'claim-result-link', 'data-type' => ty.id, 'data-result' => result.id) %>
                    <% end %>
                </ul>
            </div>
            <!--
            <div id="claim_link_<%= result.id %>"><%= claim_result_link(result) %></div>
            -->
        </td>
        <td><div id="claims_<%= result.id %>"><%= result.claims_for_user(current_user) %></div></td>
    </tr>
    
    <% end %>
</table>
<%= paginate @results %>

